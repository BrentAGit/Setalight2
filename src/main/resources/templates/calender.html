<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="icon" href="/img/icon.png" type="image/gif" sizes="16x16">
    <meta charset="UTF-8">
    <title th:value="${application}">Setalight</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" href="/css/style.css">
    <script th:src="@{js/Calender-script.js}" src="js/Calender-script.js"></script>
        <!--    add here personal CSS-->
    </head>
<body>
<div th:replace="fragments/header">Header</div>
<br>
<div class="container-fluid">

    <div class="large-calender">
        <div id="header" class="clearfix">
            <a href="/calender">calender</a>
            <div class="pre-button"><</div>
            <div class="head-info" id="head-info">
                <div class="head-day"></div>
                <div class="head-month"></div>
            </div>
            <div class="next-button">></div>
        </div>
        <table id="calendar">
            <thead>
            <tr>
                <th>Ma</th>
                <th>Di</th>
                <th>Wo</th>
                <th>Do</th>
                <th>vr</th>
                <th>za</th>
                <th>zo</th>
            </tr>
            </thead>
            <tbody id="body">
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<div id="event"></div>
<script th:inline="javascript">
    /*<![CDATA[*/
    let events = /*[[${events}]]*/ 'default'
    /*]]>*/
    document.addEventListener('DOMContentLoaded', function () {
        let header = document.getElementById("head-info");
        let body = document.getElementById("body");
        let pre = document.getElementsByClassName("pre-button");
        let next = document.getElementsByClassName("next-button");
        pre[0].addEventListener("click", () => {
            updateEvents(events, header, body)
        });
        next[0].addEventListener("click", () => {
            updateEvents(events, header, body)
        });
        updateEvents(events, header, body);
    });

    const updateEvents = function (events, header, body) {
        document.getElementById("event").innerHTML = "";
        let monthYear = header.children[1].innerHTML;
        let monthU = monthYear.split("-")[0].replace(/\s+/g, '');
        let yearU = monthYear.split("-")[1].replace(/\s+/g, '');
        let today = header.children[0];
        switch (monthU) {
            case "Jan":
                monthU = "01";
                break;
            case "Feb":
                monthU = "02";
                break;
            case "Maa":
                monthU = "03";
                break;
            case "Apr":
                monthU = "04";
                break;
            case "Mei":
                monthU = "05";
                break;
            case "Jun":
                monthU = "06";
                break;
            case "Jul":
                monthU = "07";
                break;
            case "Aug":
                monthU = "08";
                break;
            case "Sep":
                monthU = "09";
                break;
            case "Okt":
                monthU = "10";
                break;
            case "Nov":
                monthU = "11";
                break;
            case "Dec":
                monthU = "12";
                break;
        }
        for (let children of body.children) {
            for (let child of children.children) {
                if (child.innerHTML.length !== 0) {
                    let childDate = yearU + "-" + monthU + "-" + child.innerHTML;
                    for (let event of events) {
                        let eventDate = event.date.split("T")[0];
                        if (eventDate === childDate) {
                            child.className = "eventDay " + event.id;

                            const ttBox = document.createElement("div");

                            ttBox.id = "eventToolTip " + event.id;
                            ttBox.style.visibility = "hidden"; // make it hidden till mouse over
                            ttBox.style.position = "fixed";
                            ttBox.style.top = "1ex";
                            ttBox.style.left = "1ex";
                            ttBox.style.padding = "0.5em";
                            ttBox.style.width = "30em";
                            ttBox.style.borderRadius = "1em";
                            ttBox.style.border = "solid thin gray";
                            ttBox.style.backgroundColor = "lightgrey";

                            document.getElementById("event").append(ttBox);

                            child.addEventListener("mouseover", event => {
                                mouseOver(event);
                            });

                            child.addEventListener("mouseout", event => {
                                mouseOut(event);
                            });
                            child.addEventListener("click", () => {
                                location.assign("/event/events/" + event.id);
                            });
                        }
                    }
                }
            }
        }
    }

    const mouseOver = function (event) {
        const boundBox = event.target.getBoundingClientRect();
        const coordX = boundBox.left;
        const coordY = boundBox.top;
        let elt = event.path[0];
        let ttBox = document.getElementById("eventToolTip " + elt.className.split(/\s+/g)[1]);

        ttBox.style.left = (coordX + 40).toString() + "px";
        ttBox.style.top = (coordY + 40).toString() + "px";

        // add bubble content. Can include image or link
        let eventFromDb = {};
        for (let obj of events) {
            if (obj.id.toString() === elt.className.split(/\s+/g)[1]) {
                eventFromDb = obj;
            }
        }
        let h3 = document.createElement("h3");
        h3.textContent = eventFromDb.name;
        let pDescription = document.createElement("p");
        pDescription.textContent = eventFromDb.description;
        let pStart = document.createElement("p");
        pStart.textContent = "start tijd: " +  eventFromDb.startTime;
        let pEnd = document.createElement("p");
        pEnd.textContent = "eind tijd: " +  eventFromDb.endTime;
        ttBox.append(h3, pDescription, pStart, pEnd);

        ttBox.style.visibility = "visible";
    }

    const mouseOut = function (event) {
        let elt = event.path[0];
        let ttBox = document.getElementById("eventToolTip " + elt.className.split(/\s+/g)[1]);
        ttBox.style.visibility = "hidden";
        ttBox.innerHTML = "";
    }
</script>
</body>
</html>